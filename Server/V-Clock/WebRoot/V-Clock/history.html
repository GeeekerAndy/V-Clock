<!DOCTYPE HTML>

<html>

	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<title>V-Clock</title>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta name="description" content="face recognition" />
		<!-- Facebook and Twitter integration -->
		<meta property="og:title" content="" />
		<meta property="og:image" content="" />
		<meta property="og:url" content="" />
		<meta property="og:site_name" content="" />
		<meta property="og:description" content="" />
		<meta name="twitter:title" content="" />
		<meta name="twitter:image" content="" />
		<meta name="twitter:url" content="" />
		<meta name="twitter:card" content="" />
		<meta http-equiv="Access-Control-Allow-Origin" content="*" />
		<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700" rel="stylesheet">

		<!-- Animate.css -->
		<link rel="stylesheet" href="css/animate.css">
		<!-- Icomoon Icon Fonts-->
		<link rel="stylesheet" href="css/icomoon.css">
		<!-- Bootstrap  -->
		<link rel="stylesheet" href="css/bootstrap.css">

		<!-- Magnific Popup -->
		<link rel="stylesheet" href="css/magnific-popup.css">

		<!-- Theme style  -->
		<link rel="stylesheet" href="css/style.css">
		<link rel="stylesheet" href="css/pagination.css">
		<link rel="stylesheet" href="css/zzsc.css" type="text/css">
		<script src="js/jquery.min.js"></script>
		
		
		
		<!-- Modernizr JS -->
		<script src="js/modernizr-2.6.2.min.js"></script>
		<!-- FOR IE9 below -->
		<!--[if lt IE 9]>
	<script src="js/respond.min.js"></script>
	<![endif]-->

	</head>

	<body>

		<div class="fh5co-loader"></div>


			<nav class="fh5co-nav" role="navigation">
				<div class="container">
					<div class="row">
						<div class="col-xs-2 text-left">
							<div id="fh5co-logo">
								<a href="index.html" style="text-decoration: none;"><img src="images/LOGO.png" style="height: 2em;width: 6em;" /> </a>
							</div>
						</div>
						<div class="col-xs-10 text-right menu-1">
							<ul>
								<li>
									<a href="guestsList.html" style="text-decoration: none;">嘉宾列表</a>
								</li>
								<li class="has-dropdown">
									<a href="message.html" style="text-decoration: none;">消息</a>

								</li>

								<li class="active">
									<a href="history.html" style="text-decoration: none;">历史记录</a>
								</li>
								<li class="has-dropdown" class="active">
									<a href="PersonalInfo.html" style="text-decoration: none;">设置</a>
									<ul class="dropdown">
										<li>
											<a href="PersonalInfo.html" style="text-decoration: none;">我的</a>
										</li>
										<li>
											<a href="index.html" style="text-decoration: none;">注销</a>
										</li>

									</ul>
								</li>

							</ul>
						</div>
					</div>

				</div>
			</nav>

			<header id="fh5co-header" class="fh5co-cover fh5co-cover-sm" role="banner" style="background-image:url(images/timg.jpg);" data-stellar-background-ratio="0.5">
				<div class="overlay"></div>
				<div class="container">
					<div class="row">
						<div class="col-md-7 text-left">
							<div class="display-t">
								<div class="display-tc animate-box" data-animate-effect="fadeInUp">
									<h1 style="font-size: 4.5em;">V-Clock</h1>
									<h2 style="font-size:2em;">智能人脸识别系统迎宾模块</h2>
								</div>
							</div>
						</div>
					</div>
				</div>
			</header>

			<div id="fh5co-services" style="padding-top: 1%;  background-color: #F0F5F9;">
				<div class="container">
					<div style="margin-bottom: 5%;">
						<div class="row animate-box row-pb-md"></div>
						<div class="row"><span class="loadTitle"></span>
							<div class="col-md-2"></div>
							<!--<div id="msg-left" class="col-md-4 col-sm-6"><span class="loadTitle"></span></div>
						<div id="msg-midle" class="col-md-4 col-sm-6"><span class="loadTitle"></span></div>-->
							<div class="col-md-8">
								<div id="msg-right" class="col-md-12 col-sm-6"><span class="loadTitle"></span></div>
							</div>
							<div class="col-md-2"></div>
						</div>
					</div>

					<div class="col-md-12 text-center">

						<!--<a href='javascript:first();'>First</a>
					<a href='javascript:pre();'>Previous</a>-->
						<a href='javascript:next();'>加载更多</a>
						<!--<a href='javascript:last();'>Last</a>-->
						<span>(当前页数: </span>
						<span id="current_index"></span>
						<span> ,总页数: </span>

						<span id="total_num"></span>
						<span>)</span>

					</div>

			<footer id="fh5co-footer" role="contentinfo" style="padding-top:30px;padding-bottom:10px">
				<div class="container">

					<div class="row copyright">
						<div class="col-md-12 text-center">
							<p>
							<small class="block">项目名称：V-CLOCK&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;制作团队：五花八人</small>		
							</p>

						</div>
					</div>

				</div>
			</footer>
				</div>
			</div>

			<div class="gototop js-top">
				<a href="#" class="js-gotop"><i class="icon-arrow-up"></i></a>
			</div>

			<!-- jQuery -->
			<script src="js/jquery.min.js"></script>
			<!-- jQuery Easing -->
			<script src="js/jquery.easing.1.3.js"></script>
			<!-- Bootstrap -->
			<script src="js/bootstrap.min.js"></script>
			<!-- Waypoints -->
			<script src="js/jquery.waypoints.min.js"></script>
			<!-- countTo -->
			<script src="js/jquery.countTo.js"></script>
			<!-- Magnific Popup -->
			<script src="js/jquery.magnific-popup.min.js"></script>
			<script src="js/magnific-popup-options.js"></script>
			<!-- Stellar -->
			<script src="js/jquery.stellar.min.js"></script>
			<!-- Main -->
			<script src="js/main.js"></script>
			<script src="js/jquery.pagination.js"></script>
			<script src="js/sms.js"></script>

			<script>

$(document).ready(function() {
$.ajax({
	type:"post",
	url:"http://121.250.222.75:8080/V-Clock/servlet/WDisplayVisitingRecordServlet",
	async:false,
	dataType: "json",
	xhrFields: {		
			withCredentials: true	
		},
		data:{
			page:'1'
		},
		error:function(){
			alert("发生错误！！");
		},
	success:function(result) {
						if(result.tip == '2') {
							//alert(result.tip);
							alert("数据错误！");
						} else {
							pc = result.allPageCount;
							//    alert(pc);
							//			//在页面上显示总共有几页
							//			function show_total_page_num() {
							document.getElementById("current_index").innerHTML = '1';
							document.getElementById("total_num").innerHTML = pc;
							//			}

							var obj = result.VisitingRecord;
							//alert(obj);
							//			var $left = $("#msg-left");
							//			var $midle = $("#msg-midle");
							var $right = $("#msg-right");
							$.each(obj, function(infoIndex, info) {
								var strHtml = ""; //存储数据的变量
								var strHtml1 = ""; //存储数据的变量

								strHtml += "姓名：" + info["gname"] + "<br>";
								strHtml += "到达时间：" + info["arrivingdate"] + "<br>";
								strHtml1 += info["gphoto"];
								var div = $("<div class='feature-center ' style='background-color: #FFFFFF;'>" +
									"<div>" +
									"<nobr class='author'><img align='left' style='width: 60px;height: 60px;margin-right: 30px;'src='data:image/jpeg;base64," + strHtml1 + "'> </nobr>" +
									"</div>" +
									"<div id='divframe'>" +

									"<div style='height: 40px;'>" + strHtml + "</div>" +
									"</div>" +

									"</div>");
								div.appendTo($right);
							});

						}
					}
});
var getting = {
					type: 'get',
					url: 'http://121.250.222.75:8080/V-Clock/servlet/PushMessageServlet',
					dataType: 'jsonp',
					jsonp: 'callback',
					jsonpCallback: "flightHandler",
					timeout: 0,
					async:true,
					xhrFields: {
						withCredentials: true
					},
					complete: function(xhr, status) {
						$.ajax(getting);
					},
					success: function(data) {
						var strHtml = ""; //存储数据的变量
						strHtml += "员工编号：" + data.eid + "<br>";
						strHtml += "嘉宾姓名：" + data.gname + "<br>";
						strHtml += "到达时间：" + data.arrivingDate;
						//var k=localStorage.getItem("index");
						 var k =parseInt(localStorage.getItem("index"));
						 k+=1;
						alert("你有新嘉宾已到达！");
					    localStorage.setItem(k, strHtml);
						localStorage.setItem("index",k);
						//localStorage.index=k;
					}
				};
				//alert("ajax");
				$.ajax(getting);
				});
			</script>

	</body>

</html>